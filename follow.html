<!DOCTYPE html>
<html>
  <head>
    <title>Follow</title>
    <script type="text/javascript" src="modestmaps.js"></script>
    <script type="text/javascript">
var map;

window.onload = function() {
    var provider = new com.modestmaps.TemplatedMapProvider('http://tile.openstreetmap.org/{Z}/{X}/{Y}.png');

    map = new com.modestmaps.Map(document.body, provider); 

    var canvas = document.createElement('canvas');
    canvas.style.position = 'absolute';
    canvas.style.left = '0px';
    canvas.style.top = '0px';
    canvas.width = map.dimensions.x;
    canvas.height = map.dimensions.y;
    map.parent.appendChild(canvas);

    var locations = [];

    function redraw() {
      if (locations.length > 0) {
        var ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.strokeStyle = 'black';
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.lineWidth = 2;
        ctx.beginPath();
        var p = map.locationPoint(locations[0]);
        ctx.moveTo(p.x,p.y);
        for (var i = 1; i < locations.length; i++) {
          p = map.locationPoint(locations[i]);
          ctx.lineTo(p.x, p.y);
        }
        ctx.stroke();
      }
    }

    map.addCallback('drawn', redraw);
    map.addCallback('resized', function() {
      canvas.width = map.dimensions.x;
      canvas.height = map.dimensions.y;
      redraw();
    });

    redraw();
    
    var loop = function() {
      navigator.geolocation.getCurrentPosition(function(position) {
        document.getElementById('debug').innerHTML = locations.length.toString();
        locations.push(new com.modestmaps.Location(position.coords.latitude, position.coords.longitude));
        loop();
      }, function() {
        loop();
      });
    };
    
    loop();
}

    </script>
    <style type="text/css">

html, body {
  margin: 0;
  padding: 0;
  border: 0;
  width: 100%;
  height: 100%;
}

    </style>
  </head>
  <body><div id="debug">0</div>
  </body>
</html>
